/**
 * Copyright (c) 2023 The Nuevodevel Team. All rights reserved.
 * Events plugin for video.js
 * Version 3.1.0
 */
/* eslint-disable */import videojs from"video.js";var vjs_pageTimer,_edata=null,vjs_currentSource="",_summaryData={sessionId:"",videoId:"",videoTitle:"",category:"",watchedTime:0,pauseCount:0,resumeCount:0,seekCount:0,bufferDuration:0},isIPv4=function(e){if(!e.match(/^([0-9]{1,3}\.){3}[0-9]{1,3}$/))return!1;var t;for(t of e.split("."))if(255<Number(t))return!1;return!0},isIPv6=function(e,t=8){if("::"===(e=e.toLowerCase()));else{if(!e.match(/^([0-9a-f]{0,4}:?){2,8}$/))return!1;if(":"===e[e.length-1])if(":"!==e[e.length-2])return!1;if(2<e.split("::").length)return!1;if(1===e.split("::").length)if(e.split(":").length!==t)return!1;if(2===e.split("::").length){var i=(i=e.split("::")[1]).split(":");for(let e=0;e<i.length-1;e++)if(""===i[e])return!1}}return!0},isIPv64=function(e){var[e,t]=splitIPv64(e);return isIPv6(e,6)&&isIPv4(t)},isIPv4MappedIPv6=function(e){return isIPv64(e)&&(!binaryIPv64(e).substring(0,96).includes("1")||!binaryIPv64(e).substring(0,80).includes("1")&&!binaryIPv64(e).substring(80,96).includes("0"))},ipType=function(e){if(isIPv4(e))return"IPv4";if(isIPv6(e))return"IPv6";if(isIPv64(e))return"IPv6_4";else return"None"},padRight=function(e,t,i="0"){for(;e.length<t;)e+=i;return e},padLeft=function(e,t,i="0"){for(;e.length<t;)e=i+e;return e},split=function(e,t){for(var i=[];0<e.length;){var a=e.substring(0,t);i.push(a);e=e.substring(t)}return i},toBinary=function(e){return Number(e).toString(2)},fromBinary=function(e){return parseInt(e,2)},binaryIPv4=function(e){return e.split(".").map(e=>padLeft(toBinary(e),8)).join("")},toHex=function(e){return e.toString(16)},binaryIPv6=function(e){var[t,i]=e.split("::"),t=t.split(":");if(void 0!==i)i=i.split(":");else i=[];for(;t.length+i.length<8;)t.push("0");var a=t.concat(i);for(let e=0;e<a.length;e++)if(0===a[e].length)a[e]="0";return a.map(e=>parseInt(e,16)).map(e=>padLeft(toBinary(e),16)).join("")},splitIPv64=function(e){var t=e.lastIndexOf(":"),i=e.substring(0,t),e=e.substring(t+1);if(":"===i[i.length-1])i+=":";return[i,e]},binaryIPv64=function(e){var[e,t]=splitIPv64(e),[i,a]=e.split("::"),i=i.split(":");if(void 0!==a)a=a.split(":");else a=[];for(;i.length+a.length<6;)i.push("0");var n=i.concat(a);for(let e=0;e<n.length;e++)if(0===n[e].length)n[e]="0";return n.map(e=>parseInt(e,16)).map(e=>padLeft(toBinary(e),16)).join("")+binaryIPv4(t)},fromBinaryIPv4=function(e){return split(e,8).map(fromBinary).join(".")},compressIPv6=function(e){var t=e.split(":"),i=0,a=null,n=!1,r=0,o=null;for(let e=0;e<t.length;e++)if(n)if("0"===t[e])r++;else{if(i<r){i=r;a=o}n=!1;r=0;o=null}else if("0"===t[e]){n=!0;r=1;o=e}if(null!==o&&i<r){i=r;a=o}if(i<2)return e;else return t.slice(0,a).join(":")+"::"+t.slice(a+i).join(":")},fromBinaryIPv6=function(e){e=split(e,16).map(fromBinary).map(toHex);return compressIPv6(e.join(":"))},fromBinaryIPv64=function(e){var t=e.substring(0,96),e=e.substring(96),t=fromBinaryIPv6(t),e=fromBinaryIPv4(e);if(":"!==t[t.length-1])t+=":";return t+e},anonymizeIPv4=function(e,t){e=binaryIPv4(e).substring(0,t),t=padRight(e,32);return fromBinaryIPv4(t)},anonymizeIPv6=function(e,t){e=binaryIPv6(e).substring(0,t),t=padRight(e,128);return fromBinaryIPv6(t)},anonymizeIPv64=function(e,t){e=binaryIPv64(e).substring(0,t),t=padRight(e,128);return fromBinaryIPv64(t)},anonymizeIP=function(e,t=24,i=24){if("string"!=typeof e);else{e=e.trim().toLowerCase();var a=ipType(e);if("IPv4"===a)return anonymizeIPv4(e,t);if("IPv6"===a)return anonymizeIPv6(e,i);if("IPv6_4"===a)if(isIPv4MappedIPv6(e))return anonymizeIPv64(e,t+96);else return anonymizeIPv64(e,i)}return null};function sendscript(e,t,i){if(""!==e.trackingUrl&&navigator.sendBeacon)if("undefined"!==e.trackingUrl)if(void 0!==e.trackingUrl)if(!_edata.uid);else{i=JSON.stringify(i);t={sessionId:_edata.uid,category:_edata.category,videoId:_edata.id,videoTitle:_edata.label,event:t,value:i};navigator.sendBeacon(e.trackingUrl,JSON.stringify(t))}}function sendbeacon(e,t){if(""===_edata.label)_edata.label=_edata.id;var i=!0;if(""!==_edata.label&&""!==e)if(window.gtag)window.gtag("event",e,{event_category:_edata.category,event_label:_edata.label,value:t,eventNonInteraction:!0});else if(window._ga)window.ga("send","event",_edata.category,e,_edata.label,t,{transport:"beacon"});else if(window._gaq)window._gaq.push(["_trackEvent",_edata.category,e,_edata.label,t,i,{transport:"beacon"}]);else if(window._paq)window._paq.push(["trackEvent",_edata.category,e,_edata.label,t])}var BufferTracking=function(e){var t=this,i=null,a=!1,n=!1,r=!1,o=0,d=function(){if(i)clearTimeout(i);r=n=a=!1;o=0},s=function(){r=!1;if(t.scrubbing()&&(!e.bufferingConfig||!e.bufferingConfig.includeScrub)){a=!0;i=setTimeout(function(){a=!1},200)}},u=function(){if(!1===r&&!1===a&&0<t.currentTime()){r=new Date;n=+t.currentTime().toFixed(2)}},l=function(){var e=+t.currentTime().toFixed(2);if(r&&e!==n){e=(new Date-r)/1e3;n=r=!1;o++;if(!_edata.uid);else t.trigger("track",{event:"buffered",sessionId:_edata.uid,category:_edata.category,videoId:_edata.id,videoTitle:_edata.label,bufferTime:e.toFixed(3),bufferCount:o})}};this.on("loadstart",d);this.on("pause",s);this.on("waiting",u);this.on("timeupdate",l)},PauseTracking=function(e){var t=this,i=0,a=null,n=!1,r=function(e){if(a)clearTimeout(a);i=0;n=!1};t.on("dispose",r);t.on("loadstart",r);t.on("pause",function(){if(t.scrubbing()||t.seeking()||n);else a=setTimeout(function(){i++;_summaryData.pauseCount=i;if(!_edata.uid);else t.trigger("track",{event:"pause",sessionId:_edata.uid,category:_edata.category,videoId:_edata.id,videoTitle:_edata.label,pauseCount:i})},300)})},ResumeTracking=function(e){var t=this,i=0,a=null,n=!1,r=function(e){if(a)clearTimeout(a);i=0;n=!1};t.on("dispose",r);t.on("loadstart",r);t.on("ended",r);t.on("play",function(){if(t.scrubbing()||t.seeking()||n||t.currentTime()<1);else{clearTimeout(vjs_pageTimer);a=setTimeout(function(){i++;_summaryData.resumeCount=i;if(!_edata.uid);else t.trigger("track",{event:"resume",sessionId:_edata.uid,category:_edata.category,videoId:_edata.id,videoTitle:_edata.label,resumeCount:i})},300)}})},PercentileTracking=function(e){var a=this,n=!1,t=!1,r=!1,i=!0,o=!1,d=!0,s=!1,u=!0,l=!1,c=!0,f=0,g=0,v=0,_=0,p=function(e){c=!(l=!(u=!(s=!(d=!(o=!(i=!(r=!(t=!(n=!1)))))))));_=v=g=f=0},y=function(){return v++},m=function(){return g++},I=function(){return _++};a.on("dispose",p);a.on("loadstart",p);a.on("tracking:pause",m);a.on("tracking:resume",y);a.on("tracking:seek",I);a.on("timeupdate",function(){var e=a.currentTime().toFixed(0);f=+a.duration().toFixed(0);if(null!==_edata){if(0<n&&n<e&&e<o&&!1!==t){t=!1;if(!_edata.uid)return;a.trigger("track",{event:"10%",sessionId:_edata.uid,category:_edata.category,videoId:_edata.id,videoTitle:_edata.label,currentTime:e,duration:f});if(a.analytics)sendbeacon("10%",n);sendscript(a,"progress","10%")}if(0<o&&o<e&&e<s&&!1!==d){d=!1;if(!_edata.uid)return;a.trigger("track",{event:"25%",sessionId:_edata.uid,category:_edata.category,videoId:_edata.id,videoTitle:_edata.label,currentTime:e,duration:f});if(a.analytics)sendbeacon("25%",o);sendscript(a,"progress","25%")}if(0<s&&s<e&&e<l&&!1!==u){u=!1;if(!_edata.uid)return;a.trigger("track",{event:"50%",sessionId:_edata.uid,category:_edata.category,videoId:_edata.id,videoTitle:_edata.label,currentTime:e,duration:f});if(a.analytics)sendbeacon("50%",s);sendscript(a,"progress","50%")}if(0<l&&l<e&&e<r&&!1!==c){c=!1;if(!_edata.uid)return;a.trigger("track",{event:"75%",sessionId:_edata.uid,category:_edata.category,videoId:_edata.id,videoTitle:_edata.label,currentTime:e,duration:f});if(a.analytics)sendbeacon("75%",l);sendscript(a,"progress","75%")}if(0<r&&r<e&&!1!==i){i=!1;if(!_edata.uid);else{a.trigger("track",{event:"90%",sessionId:_edata.uid,category:_edata.category,videoId:_edata.id,videoTitle:_edata.label,currentTime:e,duration:f});if(a.analytics)sendbeacon("90%",r);sendscript(a,"progress","90%")}}}});a.on("replay",function(){if(null!==_edata)if(!_edata.uid);else{this.trigger("track",{event:"replay",sessionId:_edata.uid,category:_edata.category,videoId:_edata.id,videoTitle:_edata.label});if(this.analytics)sendbeacon("replay",null);if(null!==_edata)sendscript(a,"replay",null)}});a.on("loadeddata",function(){if(0<(f=+a.duration().toFixed(0))){var e=(f/4).toFixed(0),t=(f/10).toFixed(0),i=(.9*f).toFixed(0);r=+i;n=+t;s=2*(o=+e);l=3*+e}});a.on("ended",function(){var e=this,t=e.duration();if(-1<e.el_.className.indexOf("vjs-live"))t=0;e.trigger("track",{event:"ended",sessionId:_edata.uid,videoId:_edata.id,category:_edata.category,videoTitle:_edata.title,duration:t});if(e.analytics)sendbeacon("completed",t);if(null!==_edata)sendscript(e,"completed",t)});a.on("fullscreenchange",function(){var e=this,t="on";if(e.isFullscreen())if(!_edata.uid);else{e.trigger("track",{event:"enterFullscreen",sessionId:_edata.uid,videoId:_edata.id,category:_edata.category,videoTitle:_edata.label,mode:t});if(e.analytics)sendbeacon("fullscreen",1);if(null!==_edata)sendscript(e,"fullscreen",1)}else if(!_edata.uid);else{e.trigger("track",{event:"exitFullscreen",sessionId:_edata.uid,videoId:_edata.id,category:_edata.category,videoTitle:_edata.label,mode:t});if(e.analytics)sendbeacon("fullscreen",0);if(null!==_edata)sendscript(e,"fullscreen",0)}})},SummaryTracking=function(e){var i=this,a=0,n=0,r=0,o=0,t=0,d=0,s=0,u=[],l="",c=0,f="Videos",g="",v=!1,_=function(){c=s=d=t=o=r=n=a=0;u=[]},p=function(){if(!_edata.uid);else{var e={event:"summary",initialLoadTime:s,totalDuration:o,watchedTime:t,pauseCount:n,seekCount:a,bufferCount:r,lastTime:c,bufferDuration:d,video_id:l,video_category:f,video_label:g,analytics:v,sessionId:_edata.uid};if(i)i.trigger("track",e)}},y=function(){var e={event:"summary",initialLoadTime:s,totalDuration:o,watchedDuration:t,pauseCount:n,seekCount:a,bufferCount:r,lastTime:c,bufferDuration:d,video_id:l,video_category:f,video_label:g,analytics:v};if(1<e.watchedDuration){if(e.analytics)sendbeacon("watchedTime",e.watchedDuration);if(null!==_edata)sendscript(i,"watchedTime",e.watchedDuration)}_()};if("function"==typeof window.addEventListener){var m=!1,I=function(){vjs_pageTimer=setTimeout(function(){y();_edata=null;vjs_currentSource=""},1e4)},b=function(e){if(m);else{if("pagehide"===e.type){m=!0;y();_edata=null;vjs_currentSource=""}else if("pageshow"===e.type)clearTimeout(vjs_pageTimer);if("visibilitychange"===e.type&&"hidden"===document.visibilityState)I()}};document.addEventListener("visibilitychange",b);window.addEventListener("pagehide",b);window.addEventListener("beforeunload",function(e){y();_edata=null;vjs_currentSource=""})}i.on("ended",p);i.on("dispose",function(){y();_edata=null;vjs_currentSource=""});i.on("timeupdate",function(){var e=+i.currentTime().toFixed(0);if(0===e);else{if(u.indexOf(e)<0)u.push(e);t=u.length;_edata.watchedDuration=u.length;c=i.currentTime().toFixed(0);_summaryData.watchedTime=t}});i.on("loadeddata",function(e,t){o=+i.duration().toFixed(0)});i.on("track",function(e,t){switch(t.event){case"seek":a=t.seekCount;break;case"pause":n=t.pauseCount;break;case"buffered":r=t.bufferCount;d+=parseFloat(t.bufferTime);_summaryData.bufferDuration=d;break;case"loaded":s=t.initialLoadTime;break;case"start":if(i.analytics)v=!0}})},PlayTracking=function(e){var t=function(){var e=this;if(null!==_edata)if(1<_edata.watchedDuration){if(e.analytics)sendbeacon("watchedTime",_edata.watchedDuration);sendscript(e,"watchedTime",_edata.watchedDuration)}_edata={}},i=function(){clearTimeout(vjs_pageTimer);var e=this;if(vjs_currentSource!==e.currentSource()){vjs_currentSource=e.currentSource();if(null!==_edata){if(_edata.id)if("function"==typeof e.video_id)if(0<_edata.id.length)if(_edata.id===e.video_id()){_summaryData.videoId=_edata.id;return}if(_edata.label)if("function"==typeof e.video_title)if(0<_edata.label.length)if(_edata.label===e.video_title()){_summaryData.videoTitle=_edata.label;return}}_edata={};if(void 0!==e.trackingUrl)_edata.trackingUrl=e.trackingUrl;else _edata.trackingUrl="";var t=Date.now();_edata.uid=_summaryData.sessionId=t;if("function"==typeof e.video_title)if(e.video_title())_edata.label=_summaryData.videoTitle=e.video_title();if("function"==typeof e.video_id)if(e.video_id())_edata.id=_summaryData.videoId=e.video_id();t=e.el_.className;_edata.category="Video";if(e.isAudio())_edata.category="Audio";if(-1<t.indexOf("vjs-live"))_edata.category="Live video";_summaryData.category=_edata.category;e.trigger("track",{event:"firstPlay",sessionId:_edata.uid,category:_edata.category,videoId:_edata.id,videoTitle:_edata.label,initialPlayTime:e.currentTime().toFixed(0)});sendscript(e,"firstPlay",e.currentTime().toFixed(0));a(e);if(e.analytics)sendbeacon("firstPlay",e.currentTime().toFixed(0))}};function a(n){function e(e,t){var i=new XMLHttpRequest;i.onreadystatechange=function(){if(4===i.readyState&&200===i.status)if(i.responseText){var e=i.responseText,e=JSON.parse(e),a={ip_address:"Unknown",country:"N/A",country_code:"N/A",city:"N/A",region:"N/A"};Object.entries(e).forEach(e=>{const[t,i]=e;a[t]=i});if(a.ip)a.ip_address=a.ip;if(a.country_name)a.country=a.country_name;if(e.ip_address)if(n.anonymizeIP)e.ip_address=anonymizeIP(e.ip_address);else e.ip_address=e.ip_address;a.browser=o();a.device=r();_edata.userInfo=a;sendscript(n,"user",_edata.userInfo);n.trigger("track",{event:"user",sessionId:_edata.uid,category:_edata.category,videoId:_edata.id,videoTitle:_edata.label,userInfo:a})}};i.open("GET",e,!0);i.send(null)}var t="//ipapi.co/json/";if(n.abstractApiKey)t="//ipgeolocation.abstractapi.com/v1/?api_key="+n.abstractApiKey;else if(n.ipdataApiKey)t="//api.ipdata.co?api-key="+n.ipdataApiKey;if(n.userIP)e(t)}function r(){if("undefined"!==window.orientation&&void 0!==window.orientation)return"Mobile";else return"Desktop"}function o(){if(-1!==navigator.userAgent.indexOf("Chrome"))return"Google Chrome";else if(-1!==navigator.userAgent.indexOf("Firefox"))return"Mozilla Firefox";else if(-1!==navigator.userAgent.indexOf("MSIE"))return"Internet Exploder";else if(-1!==navigator.userAgent.indexOf("Edge"))return"Edge";else if(-1!==navigator.userAgent.indexOf("Safari"))return"Safari";else if(-1!==navigator.userAgent.indexOf("Opera"))return"Opera";else if(-1!==navigator.userAgent.indexOf("YaBrowser"))return"Yandex";else return"Other"}var n=function(){_edata={}};this.on("dispose",n);this.on("loadeddata",t);this.on("playing",i)},SeekTracking=function(e){var t=this;if(-1<t.el_.className.indexOf("vjs-live"));else{var i=0,a=0,n=function(){a=i=0};t.on("dispose",n);t.on("loadstart",n);n=t.el().querySelector(".vjs-progress-holder");n.onmouseup=n.ontouchend=function(){a=t.currentTime().toFixed(2);i++;_summaryData.seekCount=i;setTimeout(function(){if(!_edata.uid);else t.trigger("track",{event:"seek",sessionId:_edata.uid,videoId:_edata.id,category:_edata.category,videoTitle:_edata.label,seekTo:a,seekCount:i})},200)}}},MuteTracking=function(e){var t=this;t.on("volumechange",function(){if(!_edata.uid);else if(1<t.currentTime()){if(t.muted())t.trigger("track",{event:"mute",sessionId:_edata.uid,category:_edata.category,videoId:_edata.id,videoTitle:_edata.label});if(!0!==t.muted())t.trigger("track",{event:"unmute",sessionId:_edata.uid,category:_edata.category,videoId:_edata.id,videoTitle:_edata.label})}})},RateTracking=function(e){var i=this;i.on("ratechanged",function(e,t){if(!_edata.uid);else if(t.oldRate!==t.newRate)i.trigger("track",{event:"rateChange",sessionId:_edata.uid,category:_edata.category,videoId:_edata.id,videoTitle:_edata.label,rate:t.newRate})})},ResolutionChange=function(e){var i=this;i.on("resolutionchange",function(e,t){if(!_edata.uid);else i.trigger("track",{event:"resolutionChange",sessionId:_edata.uid,category:_edata.category,videoId:_edata.id,videoTitle:_edata.label,resolution:t.res})})},defaults={analytics:!1,trackingUrl:void 0,abstractApiKey:void 0,ipdataApiKey:void 0,anonymizeIP:!1,base64:!1,userIP:!0},events=function(t){try{t=videojs.obj.merge(defaults,t)}catch(e){t=videojs.mergeOtions(defaults,t)}this.analytics=t.analytics;this.anonymizeIP=t.anonymizeIP;this.userIP=t.userIP;this.abstractApiKey=t.abstractApiKey;this.ipdataApiKey=t.ipdataApiKey;this.trackingUrl=t.trackingUrl;this.base64=t.base64;this.getSummary=function(){return _summaryData};PauseTracking.apply(this,arguments);ResumeTracking.apply(this,arguments);MuteTracking.apply(this,arguments);RateTracking.apply(this,arguments);BufferTracking.apply(this,arguments);PercentileTracking.apply(this,arguments);PlayTracking.apply(this,arguments);SeekTracking.apply(this,arguments);SummaryTracking.apply(this,arguments);ResolutionChange.apply(this,arguments)};if("undefined"!=typeof window){var registerPlugin=videojs.registerPlugin||videojs.plugin,getPlugin=videojs.getPlugin||videojs.plugin;if(void 0===getPlugin("events"))registerPlugin("events",events)}events.VERSION="3.1.0";export default events;
