/**
 * Copyright (c) 2023 The Nuevodevel Team. All rights reserved.
 * Events plugin for video.js
 * Version 3.1.0
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("video.js")):"function"==typeof define&&define.amd?define(["video.js"],t):e.videojsEventTracking=t(e.videojs)}(this,function(i){"use strict";i="default"in i?i.default:i;var v,h=null,p="",y={sessionId:"",videoId:"",videoTitle:"",category:"",pauseCount:0,resumeCount:0,watchedTime:0,seekCount:0,bufferDuration:0},n=function(e){if(!e.match(/^([0-9]{1,3}\.){3}[0-9]{1,3}$/))return!1;var t;for(t of e.split("."))if(255<Number(t))return!1;return!0},r=function(e,t=8){if("::"!==(e=e.toLowerCase())){if(!e.match(/^([0-9a-f]{0,4}:?){2,8}$/))return!1;if(":"===e[e.length-1]&&":"!==e[e.length-2])return!1;if(2<e.split("::").length)return!1;if(1===e.split("::").length&&e.split(":").length!==t)return!1;if(2===e.split("::").length){var i=(i=e.split("::")[1]).split(":");for(let e=0;e<i.length-1;e++)if(""===i[e])return!1}}return!0},t=function(e){var[e,t]=b(e);return r(e,6)&&n(t)},o=function(e){return t(e)&&(!I(e).substring(0,96).includes("1")||!I(e).substring(0,80).includes("1")&&!I(e).substring(80,96).includes("0"))},a=function(e){return n(e)?"IPv4":r(e)?"IPv6":t(e)?"IPv6_4":"None"},u=function(e,t,i="0"){for(;e.length<t;)e+=i;return e},s=function(e,t,i="0"){for(;e.length<t;)e=i+e;return e},d=function(e,t){for(var i=[];0<e.length;){var n=e.substring(0,t);i.push(n),e=e.substring(t)}return i},l=function(e){return Number(e).toString(2)},c=function(e){return parseInt(e,2)},g=function(e){return e.split(".").map(e=>s(l(e),8)).join("")},f=function(e){return e.toString(16)},m=function(e){for(var[t,i]=e.split("::"),t=t.split(":"),i=void 0!==i?i.split(":"):[];t.length+i.length<8;)t.push("0");var n=t.concat(i);for(let e=0;e<n.length;e++)0===n[e].length&&(n[e]="0");return n.map(e=>parseInt(e,16)).map(e=>s(l(e),16)).join("")},b=function(e){var t=e.lastIndexOf(":"),i=e.substring(0,t),e=e.substring(t+1);return":"===i[i.length-1]&&(i+=":"),[i,e]},I=function(e){for(var[e,t]=b(e),[i,n]=e.split("::"),i=i.split(":"),n=void 0!==n?n.split(":"):[];i.length+n.length<6;)i.push("0");var r=i.concat(n);for(let e=0;e<r.length;e++)0===r[e].length&&(r[e]="0");return r.map(e=>parseInt(e,16)).map(e=>s(l(e),16)).join("")+g(t)},T=function(e){return d(e,8).map(c).join(".")},k=function(e){var t=e.split(":"),i=0,n=null,r=!1,o=0,a=null;for(let e=0;e<t.length;e++)r?"0"===t[e]?o++:(i<o&&(i=o,n=a),r=!1,o=0,a=null):"0"===t[e]&&(r=!0,o=1,a=e);return null!==a&&i<o&&(i=o,n=a),i<2?e:t.slice(0,n).join(":")+"::"+t.slice(n+i).join(":")},w=function(e){e=d(e,16).map(c).map(f);return k(e.join(":"))},x=function(e){var t=e.substring(0,96),e=e.substring(96),t=w(t),e=T(e);return":"!==t[t.length-1]&&(t+=":"),t+e},_=function(e,t){e=g(e).substring(0,t),t=u(e,32);return T(t)},C=function(e,t){e=m(e).substring(0,t),t=u(e,128);return w(t)},A=function(e,t){e=I(e).substring(0,t),t=u(e,128);return x(t)},F=function(e,t=24,i=24){if("string"!=typeof e)return null;e=e.trim().toLowerCase();var n=a(e);return"IPv4"===n?_(e,t):"IPv6"===n?C(e,i):"IPv6_4"===n?o(e)?A(e,t+96):A(e,i):null};function O(e,t,i){""!==e.trackingUrl&&navigator.sendBeacon&&"undefined"!==e.trackingUrl&&void 0!==e.trackingUrl&&""!==h.label&&""!==t&&(i=JSON.stringify(i),t={sessionId:h.uid,category:h.category,videoId:h.id,videoTitle:h.label,event:t,value:i},navigator.sendBeacon(e.trackingUrl,JSON.stringify(t)))}function P(e,t){""===h.label&&(h.label=h.id);""!==h.label&&""!==e&&(window.gtag?window.gtag("event",e,{event_category:h.category,event_label:h.label,value:t,eventNonInteraction:!0}):window._ga?window.ga("send","event",h.category,e,h.label,t,{transport:"beacon"}):window._gaq?window._gaq.push(["_trackEvent",h.category,e,h.label,t,!0,{transport:"beacon"}]):window._paq&&window._paq.push(["trackEvent",h.category,e,h.label,t]))}function e(e){var t,i,n=this,r=0,o=0,a=0,u=0,s=0,d=0,l=[],c=0,g=function(){c=d=s=u=a=o=r=0,l=[]},f=function(){var e={event:"summary",totalDuration:u,watchedDuration:s,pauseCount:o,seekCount:r,bufferCount:a,lastTime:c,bufferDuration:d};O(n,"summary",e),1<e.watchedDuration&&n.analytics&&P("watchedTime",e.watchedDuration),g()};"function"==typeof window.addEventListener&&(t=!1,i=function(e){t||("pagehide"===e.type?(t=!0,f(),h=null,p=""):"pageshow"===e.type&&clearTimeout(v),"visibilitychange"===e.type&&"hidden"===document.visibilityState&&(v=setTimeout(function(){f(),h=null,p=""},1e4)))},document.addEventListener("visibilitychange",i),window.addEventListener("pagehide",i),window.addEventListener("beforeunload",function(e){f(),h=null,p=""})),n.on("ended",function(){var e={event:"summary",totalDuration:u,watchedTime:s,pauseCount:o,seekCount:r,bufferCount:a,lastTime:c,bufferDuration:d};n&&(n.trigger("track",e),O(n,"summary",e))}),n.on("dispose",function(){f(),h=null,p=""}),n.on("timeupdate",function(){var e=+n.currentTime().toFixed(0);0!=e&&(l.indexOf(e)<0&&l.push(e),s=l.length,h.watchedDuration=l.length,c=n.currentTime().toFixed(0),y.watchedTime=s)}),n.on("loadeddata",function(e,t){u=+n.duration().toFixed(0)}),n.on("track",function(e,t){switch(t.event){case"seek":r=t.seekCount;break;case"pause":o=t.pauseCount;break;case"buffered":a=t.bufferCount,d+=parseFloat(t.bufferTime),y.bufferDuration=d;break;case"loaded":initialLoadTime=t.initialLoadTime;break;case"start":n.analytics}})}function j(e){this.on("dispose",function(){h={}}),this.on("loadeddata",function(){null!==h&&1<h.watchedDuration&&(this.analytics&&P("watchedTime",h.watchedDuration),O(this,"watchedTime",h.watchedDuration)),h={}}),this.on("playing",function(){clearTimeout(v);var e=this;if(p!==e.currentSource()){if(p=e.currentSource(),null!==h){if(h.id&&"function"==typeof e.video_id&&0<h.id.length&&h.id===e.video_id())return void(y.videoId=h.id);if(h.label&&"function"==typeof e.video_title&&0<h.label.length&&h.label===e.video_title())return void(y.videoTitle=h.label)}h={},void 0!==e.trackingUrl?h.trackingUrl=e.trackingUrl:h.trackingUrl="";var t=Date.now(),t=(h.uid=y.sessionId=t,"function"==typeof e.video_title&&e.video_title()&&(h.label=y.videoTitle=e.video_title()),"function"==typeof e.video_id&&e.video_id()&&(h.id=y.videoId=e.video_id()),e.el_.className),n=(h.category="Video",e.isAudio()&&(h.category="Audio"),-1<t.indexOf("vjs-live")&&(h.category="Live video"),y.category=h.category,e.trigger("track",{event:"firstPlay",sessionId:h.uid,category:h.category,videoId:h.id,videoTitle:h.label,initialPlayTime:e.currentTime().toFixed(0)}),O(e,"firstPlay",e.currentTime().toFixed(0)),e);function i(e){var t=new XMLHttpRequest;t.onreadystatechange=function(){var e,i;4===t.readyState&&200===t.status&&t.responseText&&(e=t.responseText,e=JSON.parse(e),i={ip_address:"Unknown",country:"N/A",country_code:"N/A",city:"N/A",region:"N/A"},Object.entries(e).forEach(e=>{var[e,t]=e;i[e]=t}),i.ip&&(i.ip_address=i.ip),i.country_name&&(i.country=i.country_name),e.ip_address&&(n.anonymizeIP?e.ip_address=F(e.ip_address):e.ip_address=e.ip_address),i.browser=-1!==navigator.userAgent.indexOf("Chrome")?"Google Chrome":-1!==navigator.userAgent.indexOf("Firefox")?"Mozilla Firefox":-1!==navigator.userAgent.indexOf("MSIE")?"Internet Exploder":-1!==navigator.userAgent.indexOf("Edge")?"Edge":-1!==navigator.userAgent.indexOf("Safari")?"Safari":-1!==navigator.userAgent.indexOf("Opera")?"Opera":-1!==navigator.userAgent.indexOf("YaBrowser")?"Yandex":"Other",i.device="undefined"===window.orientation||void 0===window.orientation?"Desktop":"Mobile",h.userInfo=i,O(n,"user",h.userInfo),n.trigger("track",{event:"user",sessionId:h.uid,category:h.category,videoId:h.id,videoTitle:h.label,userInfo:i}))},t.open("GET",e,!0),t.send(null)}t="//ipapi.co/json/";n.abstractApiKey?t="//ipgeolocation.abstractapi.com/v1/?api_key="+n.abstractApiKey:n.ipdataApiKey&&(t="//api.ipdata.co?api-key="+n.ipdataApiKey),n.userIP&&i(t),e.analytics&&P("firstPlay",e.currentTime().toFixed(0))}})}function D(t){try{t=i.obj.merge(S,t)}catch(e){t=i.mergeOtions(S,t)}this.analytics=t.analytics,this.anonymizeIP=t.anonymizeIP,this.userIP=t.userIP,this.abstractApiKey=t.abstractApiKey,this.ipdataApiKey=t.ipdataApiKey,this.trackingUrl=t.trackingUrl,this.base64=t.base64,this.getSummary=function(){return y},function(e){function t(e){r&&clearTimeout(r),n=0,o=!1}var i=this,n=0,r=null,o=!1;i.on("dispose",t),i.on("loadstart",t),i.on("pause",function(){i.scrubbing()||i.seeking()||o||(r=setTimeout(function(){n++,y.pauseCount=n,i.trigger("track",{event:"pause",sessionId:h.uid,category:h.category,videoId:h.id,videoTitle:h.label,pauseCount:n})},300))})}.apply(this,arguments),function(e){function t(e){r&&clearTimeout(r),n=0,o=!1}var i=this,n=0,r=null,o=!1;i.on("dispose",t),i.on("loadstart",t),i.on("ended",t),i.on("play",function(){i.scrubbing()||i.seeking()||o||i.currentTime()<1||(clearTimeout(v),r=setTimeout(function(){n++,y.resumeCount=n,i.trigger("track",{event:"resume",sessionId:h.uid,category:h.category,videoId:h.id,videoTitle:h.label,resumeCount:n})},300))})}.apply(this,arguments),function(e){var t=this;t.on("volumechange",function(){1<t.currentTime()&&(t.muted()&&t.trigger("track",{event:"mute",sessionId:h.uid,category:h.category,videoId:h.id,videoTitle:h.label}),!0!==t.muted())&&t.trigger("track",{event:"unmute",sessionId:h.uid,category:h.category,videoId:h.id,videoTitle:h.label})})}.apply(this,arguments),function(e){var i=this;i.on("ratechanged",function(e,t){t.oldRate!==t.newRate&&i.trigger("track",{event:"rateChange",sessionId:h.uid,category:h.category,videoId:h.id,videoTitle:h.label,rate:t.newRate})})}.apply(this,arguments),function(e){var t=this,i=null,n=!1,r=!1,o=!1,a=0;this.on("loadstart",function(){i&&clearTimeout(i),o=r=n=!1,a=0}),this.on("pause",function(){o=!1,!t.scrubbing()||e.bufferingConfig&&e.bufferingConfig.includeScrub||(n=!0,i=setTimeout(function(){n=!1},200))}),this.on("waiting",function(){!1===o&&!1===n&&0<t.currentTime()&&(o=new Date,r=+t.currentTime().toFixed(2))}),this.on("timeupdate",function(){var e=+t.currentTime().toFixed(2);o&&e!==r&&(e=(new Date-o)/1e3,r=o=!1,a++,t.trigger("track",{event:"buffered",sessionId:h.uid,category:h.category,videoId:h.id,videoTitle:h.label,bufferTime:e.toFixed(3),bufferCount:a}))})}.apply(this,arguments),function(e){function t(e){g=!(c=!(l=!(d=!(s=!(u=!(a=!(o=!(i=!(r=!1))))))))),y=p=v=f=0}var n=this,r=!1,i=!1,o=!1,a=!0,u=!1,s=!0,d=!1,l=!0,c=!1,g=!0,f=0,v=0,p=0,y=0;n.on("dispose",t),n.on("loadstart",t),n.on("tracking:pause",function(){return v++}),n.on("tracking:resume",function(){return p++}),n.on("tracking:seek",function(){return y++}),n.on("timeupdate",function(){var e=n.currentTime().toFixed(0);f=+n.duration().toFixed(0),null!==h&&(0<r&&r<e&&e<u&&!1!==i&&(i=!1,n.trigger("track",{event:"10%",sessionId:h.uid,category:h.category,videoId:h.id,videoTitle:h.label,currentTime:e,duration:f}),n.analytics&&P("10%",r),O(n,"progress","10%")),0<u&&u<e&&e<d&&!1!==s&&(s=!1,n.trigger("track",{event:"25%",sessionId:h.uid,category:h.category,videoId:h.id,videoTitle:h.label,currentTime:e,duration:f}),n.analytics&&P("25%",u),O(n,"progress","25%")),0<d&&d<e&&e<c&&!1!==l&&(l=!1,n.trigger("track",{event:"50%",sessionId:h.uid,category:h.category,videoId:h.id,videoTitle:h.label,currentTime:e,duration:f}),n.analytics&&P("50%",d),O(n,"progress","50%")),0<c&&c<e&&e<o&&!1!==g&&(g=!1,n.trigger("track",{event:"75%",sessionId:h.uid,category:h.category,videoId:h.id,videoTitle:h.label,currentTime:e,duration:f}),n.analytics&&P("75%",c),O(n,"progress","75%")),0<o)&&o<e&&!1!==a&&(a=!1,n.trigger("track",{event:"90%",sessionId:h.uid,category:h.category,videoId:h.id,videoTitle:h.label,currentTime:e,duration:f}),n.analytics&&P("90%",o),O(n,"progress","90%"))}),n.on("replay",function(){null!==h&&(this.trigger("track",{event:"replay",sessionId:h.uid,category:h.category,videoId:h.id,videoTitle:h.label}),this.analytics&&P("replay",null),null!==h)&&O(n,"replay",null)}),n.on("loadeddata",function(){var e,t,i;0<(f=+n.duration().toFixed(0))&&(e=(f/4).toFixed(0),t=(f/10).toFixed(0),i=(.9*f).toFixed(0),o=+i,r=+t,d=2*(u=+e),c=3*+e)}),n.on("ended",function(){var e=this,t=e.duration();-1<e.el_.className.indexOf("vjs-live")&&(t=0),e.trigger("track",{event:"ended",sessionId:h.uid,videoId:h.id,category:h.category,videoTitle:h.title,duration:t}),e.analytics&&P("completed",t),null!==h&&O(e,"completed",t)}),n.on("fullscreenchange",function(){var e=this;e.isFullscreen()?(e.trigger("track",{event:"enterFullscreen",sessionId:h.uid,videoId:h.id,category:h.category,videoTitle:h.label,mode:"on"}),e.analytics&&P("fullscreen",1),null!==h&&O(e,"fullscreen",1)):(e.trigger("track",{event:"exitFullscreen",sessionId:h.uid,videoId:h.id,category:h.category,videoTitle:h.label,mode:"on"}),e.analytics&&P("fullscreen",0),null!==h&&O(e,"fullscreen",0))})}.apply(this,arguments),j.apply(this,arguments),function(e){var t,i,n,r=this;-1<r.el_.className.indexOf("vjs-live")||(i=t=0,r.on("dispose",n=function(){i=t=0}),r.on("loadstart",n),(n=r.el().querySelector(".vjs-progress-holder")).onmouseup=n.ontouchend=function(){i=r.currentTime().toFixed(2),t++,y.seekCount=t,setTimeout(function(){r.trigger("track",{event:"seek",sessionId:h.uid,videoId:h.id,category:h.category,videoTitle:h.label,seekTo:i,seekCount:t})},200)})}.apply(this,arguments),e.apply(this,arguments),function(e){var i=this;i.on("resolutionchange",function(e,t){i.trigger("track",{event:"resolutionChange",sessionId:h.uid,category:h.category,videoId:h.id,videoTitle:h.label,resolution:t.res})})}.apply(this,arguments)}var S={analytics:!1,trackingUrl:void 0,abstractApiKey:void 0,ipdataApiKey:void 0,anonymizeIP:!1,base64:!1,userIP:!0},N=i.registerPlugin||i.plugin;return void 0===(i.getPlugin||i.plugin)("events")&&N("events",D),D.VERSION="3.1.0",D});
